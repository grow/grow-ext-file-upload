# grow-ext-google-cloud-images

(WIP) An extension for hosting images in Google Cloud Storage and serving them via
Google's high-performance dynamic image-serving infrastructure.

## Concept

Google offers an API for serving images uploaded to Google Cloud Storage through a high-performance, dynamic image-serving infrastructure. The system provides users with a way to perform a number of operations on images on-the-fly – making it extremely well-suited for developers to implement assets sized, cropped, formatted, etc. in the right way for the user – with no added work.

For example, the image-serving infrastructure can reformat (JPG, PNG, WEBP), resize or crop, and transform the image in a number of ways on-the-fly.

Here's the workflow:

1. Upload an image to Google Cloud Storage.
1. Use the template function or YAML extension provided in this extension.
1. Supply options to the extension to generate the right URL.

Here are a few live examples:

```
# Resize to 100 pixels wide
s100
```
![](https://lh3.googleusercontent.com/UN7taQ_uv67DQ2BO_WAc5i-b_KHPl4hWXQYG9dj_8FesTSruE_k-AyPId2Jc1DujAMP_kFpD413i8T4TK-O_=s100)

```
# Smart crop, border 100%, format PNG, size 200
pp-br100-rp-s200
```
![](https://lh3.googleusercontent.com/UN7taQ_uv67DQ2BO_WAc5i-b_KHPl4hWXQYG9dj_8FesTSruE_k-AyPId2Jc1DujAMP_kFpD413i8T4TK-O_=pp-br100-rp-s200)

```
# Size 200, rotate 90
s200-r90
```
![](https://lh3.googleusercontent.com/UN7taQ_uv67DQ2BO_WAc5i-b_KHPl4hWXQYG9dj_8FesTSruE_k-AyPId2Jc1DujAMP_kFpD413i8T4TK-O_=s200-r90)

```
# Width 100, height 300, crop, smart crop, quality 100, format JPG
w100-h300-c-pp-l100-rj
```
![](https://lh3.googleusercontent.com/UN7taQ_uv67DQ2BO_WAc5i-b_KHPl4hWXQYG9dj_8FesTSruE_k-AyPId2Jc1DujAMP_kFpD413i8T4TK-O_=w100-h300-c-pp-l100-rj)


### Features

- Generates URLs for images stored in Google Cloud Storage to serve them via
  Google's high-performance dynamic image-serving infrastructure.
- Provides a reasonable way to append options to generated URLs. Options
  include image format, size, quality, etc.
- Provides a way to request localized images (by identifiers contained within
  the filename).

## Usage

### Initial setup

1. Create an `extensions.txt` file within your pod.
1. Add to the file: `git+git://github.com/grow/grow-ext-google-cloud-images`
1. Run `grow install`.
1. Add the following section to `podspec.yaml`:

```
extensions:
  jinja2:
  - extensions.google_cloud_images.GoogleCloudImagesExtension
  preprocessors:
  - extensions.google_cloud_images.GoogleCloudImagesPreprocessor

preprocessors:
- kind: google_cloud_images
  backend: <url to backend service>
```

### URL options

The `url` method of `GoogleCloudImage` objects accepts a list of options to
append to the URLs generated by Google's image-serving infrastructure. The
options determine the behavior of the image served. [See details on
StackOverflow](https://stackoverflow.com/q/25148567).

### In templates

(WIP)

```
# Default image URL.
{{google_image("/bucket/folder/path.jpg").url()}}

# Image URL with 1440 size option appended.
{{google_image("/bucket/folder/path.jpg").url(['s1440'])}}

# Localized image URL.
{{google_image("/bucket/folder/path.jpg", locale='de').url()}}
```

### In YAML

(WIP)

```
# Generates a `google_image` object YAML.
image: /bucket/folder/path.jpg !google_image 

# With the following usage in a template.
{{doc.image.url()}}
```

### Builds

(WIP)

## Backend

(WIP)
